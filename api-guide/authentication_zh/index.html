<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="Q1mi">
        <link rel="canonical" href="https://q1mi.github.io/Django-REST-framework-documentation/api-guide/authentication_zh/">
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Authentication - Django REST framework中文站点</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">

        <script src="../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">Django REST framework中文站点</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href="../.." class="nav-link">主页</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">教程 <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../tutorial/quickstart_zh/" class="dropdown-item">Quickstart</a>
</li>
                                    
<li>
    <a href="../../tutorial/1-serialization_zh/" class="dropdown-item">1 - Serialization</a>
</li>
                                    
<li>
    <a href="../../tutorial/2-requests-and-responses_zh/" class="dropdown-item">2 - Requests and responses</a>
</li>
                                    
<li>
    <a href="../../tutorial/3-class-based-views_zh/" class="dropdown-item">3 - Class based views</a>
</li>
                                    
<li>
    <a href="../../tutorial/4-authentication-and-permissions_zh/" class="dropdown-item">4 - Authentication and permissions</a>
</li>
                                    
<li>
    <a href="../../tutorial/5-relationships-and-hyperlinked-apis_zh/" class="dropdown-item">5 - Relationships and hyperlinked APIs</a>
</li>
                                    
<li>
    <a href="../../tutorial/6-viewsets-and-routers_zh/" class="dropdown-item">6 - Viewsets and routers</a>
</li>
                                    
<li>
    <a href="../../tutorial/7-schemas-and-client-libraries_zh/" class="dropdown-item">7 - Schemas and client libraries</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">API指南 <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../requests_zh/" class="dropdown-item">Requests</a>
</li>
                                    
<li>
    <a href="../responses_zh/" class="dropdown-item">Responses</a>
</li>
                                    
<li>
    <a href="../views_zh/" class="dropdown-item">Views</a>
</li>
                                    
<li>
    <a href="../generic-views_zh/" class="dropdown-item">Generic views</a>
</li>
                                    
<li>
    <a href="../viewsets_zh/" class="dropdown-item">Viewsets</a>
</li>
                                    
<li>
    <a href="../routers_zh/" class="dropdown-item">Routers</a>
</li>
                                    
<li>
    <a href="../parsers_zh/" class="dropdown-item">Parsers</a>
</li>
                                    
<li>
    <a href="../renderers_zh/" class="dropdown-item">Renderers</a>
</li>
                                    
<li>
    <a href="../serializers_zh/" class="dropdown-item">Serializers</a>
</li>
                                    
<li>
    <a href="../fields/" class="dropdown-item">Serializer fields</a>
</li>
                                    
<li>
    <a href="../relations/" class="dropdown-item">Serializer relations</a>
</li>
                                    
<li>
    <a href="../validators/" class="dropdown-item">Validators</a>
</li>
                                    
<li>
    <a href="./" class="dropdown-item active">Authentication</a>
</li>
                                    
<li>
    <a href="../permissions_zh/" class="dropdown-item">Permissions</a>
</li>
                                    
<li>
    <a href="../throttling/" class="dropdown-item">Throttling</a>
</li>
                                    
<li>
    <a href="../filtering_zh/" class="dropdown-item">Filtering</a>
</li>
                                    
<li>
    <a href="../pagination/" class="dropdown-item">Pagination</a>
</li>
                                    
<li>
    <a href="../versioning_zh/" class="dropdown-item">Versioning</a>
</li>
                                    
<li>
    <a href="../content-negotiation/" class="dropdown-item">Content negotiation</a>
</li>
                                    
<li>
    <a href="../metadata/" class="dropdown-item">Metadata</a>
</li>
                                    
<li>
    <a href="../schemas/" class="dropdown-item">Schemas</a>
</li>
                                    
<li>
    <a href="../format-suffixes/" class="dropdown-item">Format suffixes</a>
</li>
                                    
<li>
    <a href="../reverse/" class="dropdown-item">Returning URLs</a>
</li>
                                    
<li>
    <a href="../exceptions/" class="dropdown-item">Exceptions</a>
</li>
                                    
<li>
    <a href="../status-codes/" class="dropdown-item">Status codes</a>
</li>
                                    
<li>
    <a href="../testing/" class="dropdown-item">Testing</a>
</li>
                                    
<li>
    <a href="../settings/" class="dropdown-item">Settings</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">主题 <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../topics/documenting-your-api/" class="dropdown-item">Documenting your API</a>
</li>
                                    
<li>
    <a href="../../topics/api-clients/" class="dropdown-item">API Clients</a>
</li>
                                    
<li>
    <a href="../../topics/internationalization/" class="dropdown-item">Internationalization</a>
</li>
                                    
<li>
    <a href="../../topics/ajax-csrf-cors_zh/" class="dropdown-item">AJAX, CSRF & CORS</a>
</li>
                                    
<li>
    <a href="../../topics/html-and-forms/" class="dropdown-item">HTML & Forms</a>
</li>
                                    
<li>
    <a href="../../topics/browser-enhancements/" class="dropdown-item">Browser Enhancements</a>
</li>
                                    
<li>
    <a href="../../topics/browsable-api/" class="dropdown-item">The Browsable API</a>
</li>
                                    
<li>
    <a href="../../topics/rest-hypermedia-hateoas/" class="dropdown-item">REST, Hypermedia & HATEOAS</a>
</li>
                                    
<li>
    <a href="../../topics/third-party-packages.md" class="dropdown-item">Third Party Packages</a>
</li>
                                    
<li>
    <a href="../../topics/tutorials-and-resources.md" class="dropdown-item">Tutorials and Resources</a>
</li>
                                    
<li>
    <a href="../../topics/contributing.md" class="dropdown-item">Contributing to REST framework</a>
</li>
                                    
<li>
    <a href="../../topics/project-management.md" class="dropdown-item">Project management</a>
</li>
                                    
<li>
    <a href="../../topics/3.0-announcement.md" class="dropdown-item">3.0 Announcement</a>
</li>
                                    
<li>
    <a href="../../topics/3.1-announcement.md" class="dropdown-item">3.1 Announcement</a>
</li>
                                    
<li>
    <a href="../../topics/3.2-announcement.md" class="dropdown-item">3.2 Announcement</a>
</li>
                                    
<li>
    <a href="../../topics/3.3-announcement.md" class="dropdown-item">3.3 Announcement</a>
</li>
                                    
<li>
    <a href="../../topics/3.4-announcement.md" class="dropdown-item">3.4 Announcement</a>
</li>
                                    
<li>
    <a href="../../topics/3.5-announcement.md" class="dropdown-item">3.5 Announcement</a>
</li>
                                    
<li>
    <a href="../../topics/kickstarter-announcement.md" class="dropdown-item">Kickstarter Announcement</a>
</li>
                                    
<li>
    <a href="../../topics/mozilla-grant.md" class="dropdown-item">Mozilla Grant</a>
</li>
                                    
<li>
    <a href="../../topics/funding.md" class="dropdown-item">Funding</a>
</li>
                                    
<li>
    <a href="../../topics/release-notes.md" class="dropdown-item">Release Notes</a>
</li>
                                    
<li>
    <a href="../../topics/jobs.md" class="dropdown-item">Jobs</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../validators/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../permissions_zh/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="https://github.com/Q1mi/Django-REST-framework-documentation/edit/master/docs/api-guide/authentication_zh.md" class="nav-link"><i class="fa fa-github"></i> Edit on GitHub</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#_1" class="nav-link">认证</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#_2" class="nav-link">如何确定身份验证</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#_3" class="nav-link">设置认证方案</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#_4" class="nav-link">未认证和禁止的响应</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#apache-mod_wsgi" class="nav-link">Apache mod_wsgi 具体配置</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#api" class="nav-link">API 参考</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#basicauthentication" class="nav-link">BasicAuthentication</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#tokenauthentication" class="nav-link">TokenAuthentication</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#session" class="nav-link">Session认证</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#_6" class="nav-link">自定义认证</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#_7" class="nav-link">示例</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#_8" class="nav-link">第三方包</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#django-oauth-toolkit" class="nav-link">Django OAuth Toolkit</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#django-rest-framework-oauth" class="nav-link">Django REST framework OAuth</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#digest-authentication" class="nav-link">Digest Authentication</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#django-oauth2-consumer" class="nav-link">Django OAuth2 Consumer</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#json-web-token-authentication" class="nav-link">JSON Web Token Authentication</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#hawk-http-authentication" class="nav-link">Hawk HTTP Authentication</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#http-signature-authentication" class="nav-link">HTTP Signature Authentication</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#djoser" class="nav-link">Djoser</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#django-rest-auth" class="nav-link">django-rest-auth</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#django-rest-framework-social-oauth2" class="nav-link">django-rest-framework-social-oauth2</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#django-rest-knox" class="nav-link">django-rest-knox</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="_1"><a class="toclink" href="#_1">认证</a></h1>
<blockquote>
<p>身份验证功能需要可插拔。</p>
<p>&mdash; Jacob Kaplan-Moss, <a href="http://jacobian.org/writing/rest-worst-practices/">"REST worst practices"</a></p>
</blockquote>
<p>身份验证是将传入请求与一组标识凭据（例如请求来自的用户或其签名的令牌）相关联的机制。然后，<a href="../permissions_zh/">权限</a> 和 <a href="../throttling/">限制</a> 可以使用这些凭据来确定是否应允许该请求。</p>
<p>REST framework 提供了一些开箱即用的身份验证方案，并且还允许你实现自定义方案。</p>
<p>验证始终在视图的最开始进行，在执行权限和限制检查之前以及允许任何其他代码继续执行之前。</p>
<p><code>request.user</code> 属性通常被设置为<code>contrib.auth</code> 包中 <code>User</code> 类的一个实例。</p>
<p><code>request.auth</code> 属性用于任何其他身份验证信息，例如，它可以用于表示请求签名的身份验证令牌。</p>
<hr />
<p><strong>注意：</strong> 不要忘了<strong>认证本身不会允许或拒绝传入的请求</strong>，它只是简单识别请求携带的凭证。</p>
<p>有关如何设置API权限策略的信息，请参阅 <a href="../permissions_zh/">权限文档</a>。</p>
<hr />
<h2 id="_2"><a class="toclink" href="#_2">如何确定身份验证</a></h2>
<p>认证方案总是被定义为一个类的列表。REST framework 将尝试使用列表中的每个类进行身份验证，并使用成功完成验证的第一个类的返回值设置 <code>request.user</code> 和<code>request.auth</code>。</p>
<p>如果没有类进行验证，<code>request.user</code> 将被设置成 <code>django.contrib.auth.models.AnonymousUser</code>的实例，<code>request.auth</code> 将被设置成<code>None</code>。</p>
<p>未认证请求的<code>request.user</code> 和 <code>request.auth</code> 的值可以使用 <code>UNAUTHENTICATED_USER</code>和<code>UNAUTHENTICATED_TOKEN</code> 设置进行修改。</p>
<h2 id="_3"><a class="toclink" href="#_3">设置认证方案</a></h2>
<p>可以使用 <code>DEFAULT_AUTHENTICATION_CLASSES</code> 设置全局的默认身份验证方案。比如：</p>
<pre><code>REST_FRAMEWORK = {
    'DEFAULT_AUTHENTICATION_CLASSES': (
        'rest_framework.authentication.BasicAuthentication',
        'rest_framework.authentication.SessionAuthentication',
    )
}
</code></pre>
<p>你还可以使用基于<code>APIView</code>类视图的方式，在每个view或每个viewset基础上设置身份验证方案。</p>
<pre><code>from rest_framework.authentication import SessionAuthentication, BasicAuthentication
from rest_framework.permissions import IsAuthenticated
from rest_framework.response import Response
from rest_framework.views import APIView

class ExampleView(APIView):
    authentication_classes = (SessionAuthentication, BasicAuthentication)
    permission_classes = (IsAuthenticated,)

    def get(self, request, format=None):
        content = {
            'user': unicode(request.user),  # `django.contrib.auth.User` 实例。
            'auth': unicode(request.auth),  # None
        }
        return Response(content)
</code></pre>
<p>或者，如果你使用基于函数的视图，那就使用<code>@api_view</code>装饰器。</p>
<pre><code>@api_view(['GET'])
@authentication_classes((SessionAuthentication, BasicAuthentication))
@permission_classes((IsAuthenticated,))
def example_view(request, format=None):
    content = {
        'user': unicode(request.user),  # `django.contrib.auth.User` 实例。
        'auth': unicode(request.auth),  # None
    }
    return Response(content)
</code></pre>
<h2 id="_4"><a class="toclink" href="#_4">未认证和禁止的响应</a></h2>
<p>当未经身份验证的请求被拒绝时，有下面两种不同的错误代码可使用。</p>
<ul>
<li><a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html#sec10.4.2">HTTP 401 未认证</a></li>
<li><a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html#sec10.4.4">HTTP 403 无权限</a></li>
</ul>
<p>HTTP 401 响应必须始终包括一个<code>WWW-Authenticate</code>头，指示客户端如何进行身份验证。 HTTP 403响应不包括<code>WWW-Authenticate</code>。</p>
<p>具体使用哪种响应取决于认证方案。虽然可以使用多种认证方案，但是仅可以使用一种方案来确定响应的类型。<strong>在确定响应类型时，将使用视图上设置的第一个认证类。</strong></p>
<p>注意，当一个请求通过了验证但是被拒绝执行请求的权限时，不管认证方案是什么，都要使用 <code>403 Permission Denied</code> 响应。</p>
<h2 id="apache-mod_wsgi"><a class="toclink" href="#apache-mod_wsgi">Apache mod_wsgi 具体配置</a></h2>
<p>注意，如果使用 <a href="http://code.google.com/p/modwsgi/wiki/ConfigurationDirectives#WSGIPassAuthorization">Apache using mod_wsgi</a>部署，认证头默认不会传递给WSGI应用程序，它假定由Apache处理认证，而不是在应用层面处理。</p>
<p>如果你正在部署到Apache，并且使用任何non-session的身份验证，则需要显式配置mod_wsgi才能将所需的头文件传递给应用程序。这可以通过在适当的上下文中指定<code>WSGIPassAuthorization</code>指令并将其设置为<code>'On'</code>来完成。</p>
<pre><code># 这可能会在服务器配置，虚拟主机，目录或.htaccess
WSGIPassAuthorization On
</code></pre>
<hr />
<h1 id="api"><a class="toclink" href="#api">API 参考</a></h1>
<h2 id="basicauthentication"><a class="toclink" href="#basicauthentication">BasicAuthentication</a></h2>
<p>此认证方案使用<a href="http://tools.ietf.org/html/rfc2617">HTTP 基本认证</a>，针对用户的用户名和密码进行认证。基本认证通常只适用于测试。</p>
<p>如果认证成功 <code>BasicAuthentication</code> 提供以下信息。</p>
<ul>
<li><code>request.user</code> 将是一个 Django <code>User</code> 实例。</li>
<li><code>request.auth</code> 将是 <code>None</code>。</li>
</ul>
<p>那些被拒绝的未经身份验证的请求会返回使用适当WWW-Authenticate标头的<code>HTTP 401 Unauthorized</code>响应。例如：</p>
<pre><code>WWW-Authenticate: Basic realm="api"
</code></pre>
<p><strong>注意：</strong> 如果你在生产中使用<code>BasicAuthentication</code>，那么你必须确保你的API仅在<code>https</code>中可用。你还应确保你的API客户端始终在登录时重新请求用户名和密码，并且不会将这些详细信息存储到持久存储中。</p>
<h2 id="tokenauthentication"><a class="toclink" href="#tokenauthentication">TokenAuthentication</a></h2>
<p>该认证方案使用简单的基于Token的HTTP认证方案。Token认证适用于客户端 - 服务器设置，如本地桌面和移动客户端。</p>
<p>要使用<code>TokenAuthentication</code>方案，你需要<a href="#setting-the-authentication-scheme">配置认证类</a> 以便包含<code>TokenAuthentication</code>，另外在<code>INSTALLED_APPS</code>设置中还需要包含<code>rest_framework.authtoken</code>：</p>
<pre><code>INSTALLED_APPS = (
    ...
    'rest_framework.authtoken'
)
</code></pre>
<hr />
<p><strong>注意：</strong> 确保在修改设置后运行一下<code>manage.py migrate</code>。<code>rest_framework.authtoken</code> app 会提交一些Django数据库迁移操作。</p>
<hr />
<p>你还需要为你的用户创建令牌。</p>
<pre><code>from rest_framework.authtoken.models import Token

token = Token.objects.create(user=...)
print token.key
</code></pre>
<p>对客户端进行身份验证，token需要包含在 <code>Authorization</code>HTTP头中。密钥应该是以字符串"Token"为前缀，以空格分割的两个字符串。例如：</p>
<pre><code>Authorization: Token 9944b09199c62bcf9418ad846dd0e4bbdfc6ee4b
</code></pre>
<p><strong>注意：</strong> 如果你想在HTTP头中使用其他的关键字，比如<code>Bearer</code>，只需要继承<code>TokenAuthentication</code>类并设置 <code>keyword</code>类变量。</p>
<p>如果认证成功，<code>TokenAuthentication</code> 提供以下认证信息：</p>
<ul>
<li><code>request.user</code> 将是一个Django <code>User</code> 实例。</li>
<li><code>request.auth</code> 将是一个<code>rest_framework.authtoken.models.Token</code> 实例。</li>
</ul>
<p>那些被拒绝的未经身份验证的请求会返回使用适当WWW-Authenticate标头的<code>HTTP 401 Unauthorized</code>响应。例如：</p>
<pre><code>WWW-Authenticate: Token
</code></pre>
<p>命令行工具<code>curl</code> 可用于测试基于Token认证的API，例如：</p>
<pre><code>curl -X GET http://127.0.0.1:8000/api/example/ -H 'Authorization: Token 9944b09199c62bcf9418ad846dd0e4bbdfc6ee4b'
</code></pre>
<hr />
<p><strong>注意：</strong> 如果你在生产环境下使用<code>TokenAuthentication</code>认证，你必须确保你的API仅在<code>https</code>可用。</p>
<hr />
<h4 id="tokens"><a class="toclink" href="#tokens">生成Tokens</a></h4>
<h5 id="_5"><a class="toclink" href="#_5">通过使用信号</a></h5>
<p>如果你希望每个用户拥有自动生成的令牌，你可以简单地捕获用户的<code>post_save</code>信号。</p>
<pre><code>from django.conf import settings
from django.db.models.signals import post_save
from django.dispatch import receiver
from rest_framework.authtoken.models import Token

@receiver(post_save, sender=settings.AUTH_USER_MODEL)
def create_auth_token(sender, instance=None, created=False, **kwargs):
    if created:
        Token.objects.create(user=instance)
</code></pre>
<p>请注意，你需要确保将此代码段放置在已安装的<code>models.py</code>模块或Django在启动时导入的其他位置。</p>
<p>如果你已经创建了一些用户，则可以如下所示为所有现有用户生成令牌：</p>
<pre><code>from django.contrib.auth.models import User
from rest_framework.authtoken.models import Token

for user in User.objects.all():
    Token.objects.get_or_create(user=user)
</code></pre>
<h5 id="api_1"><a class="toclink" href="#api_1">通过暴露 api 端点</a></h5>
<p>当使用<code>TokenAuthentication</code>时，你可能希望为客户端提供一个获取给定用户名和密码的令牌的机制。 REST framework 提供了一个内置的视图来提供这个功能。要使用它，需要将 <code>obtain_auth_token</code> 视图添加到你的URLconf：</p>
<pre><code>from rest_framework.authtoken import views
urlpatterns += [
    url(r'^api-token-auth/', views.obtain_auth_token)
]
</code></pre>
<p>注意URL正则匹配模式那里可以是你想要使用的任何内容。</p>
<p>当使用form表单或JSON将有效的<code>username</code>和<code>password</code>字段POST提交到视图时，<code>obtain_auth_token</code>视图将返回JSON响应：</p>
<pre><code>{ 'token' : '9944b09199c62bcf9418ad846dd0e4bbdfc6ee4b' }
</code></pre>
<p>请注意，默认的<code>obtain_auth_token</code>视图显式使用JSON请求和响应，而不是使用settings中配置的默认渲染器和解析器类。如果需要自定义版本的<code>obtain_auth_token</code>视图，可以通过重写<code>ObtainAuthToken</code>类，并在url conf中使用它来实现。</p>
<p>默认情况下，没有权限或限制应用于<code>obtain_auth_token</code>视图。如果你希望应用限制，则需要重写视图类，并使用<code>throttle_classes</code>属性包含它们。</p>
<h5 id="with-django-admin"><a class="toclink" href="#with-django-admin">With Django admin</a></h5>
<p>也可以通过管理界面手动创建令牌。如果你使用的是大型用户群，我们建议你动态修改<code>TokenAdmin</code>类，以根据你的需要进行自定义，更具体地说，将<code>user</code>字段声明为<code>raw_field</code>。</p>
<p><code>your_app/admin.py</code>:</p>
<pre><code>from rest_framework.authtoken.admin import TokenAdmin

TokenAdmin.raw_id_fields = ('user',)
</code></pre>
<h2 id="session"><a class="toclink" href="#session">Session认证</a></h2>
<p>此认证方案使用Django的默认session后端进行身份验证。Session身份验证适用于与你的网站在相同的Session环境中运行的AJAX客户端。</p>
<p>如果成功验证，<code>SessionAuthentication</code> 提供以下凭据。</p>
<ul>
<li><code>request.user</code> 是一个 Django <code>User</code> 实例。</li>
<li><code>request.auth</code> 是 <code>None</code>。</li>
</ul>
<p>那些被拒绝的未经身份验证的请求会返回<code>HTTP 403 Forbidden</code>响应。</p>
<p>如果你正在使用带有SessionAuthentication的AJAX样式的API，你需要确保任何"任何"不安全的HTTP方法调用（如：<code>PUT</code>, <code>PATCH</code>, <code>POST</code> or <code>DELETE</code>请求）都包含有效的CSRF token。有关详细信息，请参阅<a href="https://docs.djangoproject.com/en/stable/ref/csrf/#ajax">Django CSRF 文档</a>。</p>
<p><strong>警告</strong>：在创建登陆页面时，始终要使用Django的标准登陆视图。这样才能确保你的登陆视图被正确的认证保护。</p>
<p>由于需要同时支持session和non-session非会话身份验证，REST框架中的CSRF验证与标准Django中的工作方式略有不同。这意味着只有经过身份验证的请求需要CSRF令牌，匿名请求可能不会发送CSRF令牌tokens。此行为不适用于始终需要使用CSRF验证的登录视图。</p>
<h1 id="_6"><a class="toclink" href="#_6">自定义认证</a></h1>
<p>要实现自定义的认证方案，要继承<code>BaseAuthentication</code>类并且重写<code>.authenticate(self, request)</code> 方法。如果认证成功，该方法应返回<code>(user, auth)</code>的二元元组，否则返回<code>None</code>。</p>
<p>在某些情况下，你可能不想返回<code>None</code>，而是希望从<code>.authenticate()</code>方法抛出<code>AuthenticationFailed</code>异常。</p>
<p>通常你应该采取的方法是：</p>
<ul>
<li>如果不尝试验证，返回<code>None</code>。还将检查任何其他正在使用的身份验证方案。</li>
<li>如果尝试验证但失败，则抛出<code>AuthenticationFailed</code>异常。无论任何权限检查也不检查任何其他身份验证方案，立即返回错误响应。</li>
</ul>
<p>你也<em>可以</em>重写<code>.authenticate_header(self, request)</code>方法。如果实现该方法，则应返回一个字符串，该字符串将用作<code>HTTP 401 Unauthorized</code>响应中的<code>WWW-Authenticate</code>头的值。</p>
<p>如果<code>.authenticate_header()</code>方法未被重写，则认证方案将在未验证的请求被拒绝访问时返回<code>HTTP 403 Forbidden</code>响应。</p>
<h2 id="_7"><a class="toclink" href="#_7">示例</a></h2>
<p>以下示例将以自定义请求标头中名称为'X_USERNAME'提供的用户名作为用户对任何传入请求进行身份验证。</p>
<pre><code>from django.contrib.auth.models import User
from rest_framework import authentication
from rest_framework import exceptions

class ExampleAuthentication(authentication.BaseAuthentication):
    def authenticate(self, request):
        username = request.META.get('X_USERNAME')
        if not username:
            return None

        try:
            user = User.objects.get(username=username)
        except User.DoesNotExist:
            raise exceptions.AuthenticationFailed('No such user')

        return (user, None)
</code></pre>
<hr />
<h1 id="_8"><a class="toclink" href="#_8">第三方包</a></h1>
<p>以下第三方包都是可用的。</p>
<h2 id="django-oauth-toolkit"><a class="toclink" href="#django-oauth-toolkit">Django OAuth Toolkit</a></h2>
<p><a href="https://github.com/evonove/django-oauth-toolkit">Django OAuth Toolkit</a> 包提供了OAuth 2.0 认证支持，并且兼容Python 2.7和Python 3.3+。这个包使用优秀的<a href="https://github.com/idan/oauthlib">OAuthLib</a>，由<a href="https://github.com/evonove/">Evonove</a>维护。该软件包有很完善的文档，并得到很好的支持，目前是我们<strong>推荐使用的OAuth 2.0支持软件包</strong>。</p>
<h4 id="_9"><a class="toclink" href="#_9">安装和配置</a></h4>
<p>使用<code>pip</code>安装。</p>
<pre><code>pip install django-oauth-toolkit
</code></pre>
<p>把这个包添加到你的<code>INSTALLED_APPS</code>中，并且修改你的REST framework设置。</p>
<pre><code>INSTALLED_APPS = (
    ...
    'oauth2_provider',
)

REST_FRAMEWORK = {
    'DEFAULT_AUTHENTICATION_CLASSES': (
        'oauth2_provider.ext.rest_framework.OAuth2Authentication',
    )
}
</code></pre>
<p>更多详情请参阅<a href="https://django-oauth-toolkit.readthedocs.io/en/latest/rest-framework/getting_started.html">Django REST framework - Getting started</a>文档。</p>
<h2 id="django-rest-framework-oauth"><a class="toclink" href="#django-rest-framework-oauth">Django REST framework OAuth</a></h2>
<p><a href="http://jpadilla.github.io/django-rest-framework-oauth/">Django REST framework OAuth</a>包提供OAuth1和OAuth2支持。</p>
<p>这个软件包以前直接包含在REST framework中，但现在已被作为第三方软件包支持和维护。</p>
<h4 id="_10"><a class="toclink" href="#_10">安装和配置</a></h4>
<p>使用<code>pip</code>进行安装。</p>
<pre><code>pip install djangorestframework-oauth
</code></pre>
<p>更多配置和使用信息请查阅Django REST framework OAuth文档中的<a href="http://jpadilla.github.io/django-rest-framework-oauth/authentication/">authentication</a>和<a href="http://jpadilla.github.io/django-rest-framework-oauth/permissions/">permissions</a>。</p>
<h2 id="digest-authentication"><a class="toclink" href="#digest-authentication">Digest Authentication</a></h2>
<p>HTTP摘要认证是一种广泛实现的方案，旨在替代HTTP基本认证，并提供简单的加密认证机制。<a href="https://github.com/juanriaza">Juan Riaza</a>维护着<a href="https://github.com/juanriaza/django-rest-framework-digestauth">djangorestframework-digestauth</a>为REST framework提供了HTTP摘要认证支持。</p>
<h2 id="django-oauth2-consumer"><a class="toclink" href="#django-oauth2-consumer">Django OAuth2 Consumer</a></h2>
<p><a href="https://github.com/Rediker-Software">Rediker Software</a>的<a href="https://github.com/Rediker-Software/doac">Django OAuth2 Consumer</a>是另一个为REST框架提供<a href="https://github.com/Rediker-Software/doac/blob/master/docs/integrations.md#">OAuth 2.0 support for REST framework</a>的软件包。该包包含tokens范围限制权限，允许对你的API进行更细粒度的访问。</p>
<h2 id="json-web-token-authentication"><a class="toclink" href="#json-web-token-authentication">JSON Web Token Authentication</a></h2>
<p>JSON Web Token是一种相当新的标准，可用于基于token的身份验证。与内置的TokenAuthentication方案不同，JWT身份验证不需要使用数据库来验证令牌。<a href="https://github.com/GetBlimp">Blimp</a>维护<a href="https://github.com/GetBlimp/django-rest-framework-jwt">djangorestframework-jwt</a>软件包，它提供了一个JWT Authentication类以及一个机制，客户端获得一个给定用户名和密码的JWT。</p>
<h2 id="hawk-http-authentication"><a class="toclink" href="#hawk-http-authentication">Hawk HTTP Authentication</a></h2>
<p><a href="https://hawkrest.readthedocs.io/en/latest/">HawkREST</a>库基于<a href="https://mohawk.readthedocs.io/en/latest/">Mohawk</a>库，让你可以在API中使用<a href="https://github.com/hueniverse/hawk">Hawk</a>签名的请求和响应。<a href="https://github.com/hueniverse/hawk">Hawk</a>让双方使用共享密钥签名的消息彼此安全地进行通信。它基于<a href="http://tools.ietf.org/html/draft-hammer-oauth-v2-mac-token-05">HTTP MAC access authentication</a>访问认证（它基于<a href="http://oauth.net/core/1.0a">OAuth 1.0</a>的部分）。</p>
<h2 id="http-signature-authentication"><a class="toclink" href="#http-signature-authentication">HTTP Signature Authentication</a></h2>
<p>HTTP签名（目前为<a href="https://datatracker.ietf.org/doc/draft-cavage-http-signatures/">IETF草案</a>）提供了一种实现HTTP消息的源认证和消息完整性的方法。与<a href="http://docs.aws.amazon.com/general/latest/gr/signature-version-4.html">Amazon的HTTP签名方案</a>类似，许多服务使用它，它允许无状态的每个请求的身份验证。<a href="https://github.com/etoccalino/">Elvio Toccalino</a>维护了<a href="https://github.com/etoccalino/django-rest-framework-httpsignature">djangorestframework-httpsignature</a>包，提供了一个易于使用的HTTP签名身份验证机制。</p>
<h2 id="djoser"><a class="toclink" href="#djoser">Djoser</a></h2>
<p><a href="https://github.com/sunscrapers/djoser">Djoser</a>库提供一组视图来处理基本操作，如注册，登录，注销，密码重置和帐户激活。该包使用自定义用户模型，它使用基于token的身份验证。这是一个可以使用REST实现的Django认证系统。</p>
<h2 id="django-rest-auth"><a class="toclink" href="#django-rest-auth">django-rest-auth</a></h2>
<p><a href="https://github.com/Tivix/django-rest-auth">Django-rest-auth</a>库提供了一组REST API端点，用于注册，身份验证（包括社交媒体身份验证），密码重置，检索和更新用户详细信息等。有了这些API端点之后，你的客户端应用程序（如AngularJS，iOS，Android和其他）可以通过REST API独立通信到Django后端站点，以进行用户管理。</p>
<h2 id="django-rest-framework-social-oauth2"><a class="toclink" href="#django-rest-framework-social-oauth2">django-rest-framework-social-oauth2</a></h2>
<p><a href="https://github.com/PhilipGarnero/django-rest-framework-social-oauth2">Django-rest-framework-social-oauth2</a>库提供了一种将社交插件（facebook，twitter，google等）集成到你的身份验证系统和简单的oauth2设置的简单方法。使用这个库，你将能够根据外部token（例如，Facebook访问token）对用户进行身份验证，将这些令牌转换为“内部”oauth2 tokens，并使用和生成oauth2 tokens来验证用户。</p>
<h2 id="django-rest-knox"><a class="toclink" href="#django-rest-knox">django-rest-knox</a></h2>
<p><a href="https://github.com/James1345/django-rest-knox">Django-rest-knox</a>库提供了模型和视图，以比内置的TokenAuthentication方案更安全和可扩展的方式来处理基于token的身份验证 - 使用单页面应用程序和移动客户端能够一起。它为每个客户端提供tokens，以及在提供一些其他身份验证（通常是基本身份验证）时生成tokens，删除token（提供服务器强制注销）和删除所有tokens（注销用户登录的所有客户端）的视图。</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js" defer></script>
        <script src="../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
